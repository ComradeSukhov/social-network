- nesting         = local_assigns.fetch(:nesting, 1)
- max_nesting     = local_assigns[:max_nesting]
- continue_thread = local_assigns[:continue_thread]

.tile.is-child{ id: dom_id(comment) }
  - if comment.deleted?
    %p.weight-semibold [deleted]
  - else
    %p.weight-semibold= link_to full_name(comment.user), user_path(comment.user)

  %span= link_to 'Link to this comment', url_for(comment: comment.id,
                                                  anchor: dom_id(comment))

  %p= simple_format comment.body
  %p.grey= creation_time(comment)

  %div{ 'data-controller' => 'reply' }
    = link_to 'Reply', '#', data: { action: 'click->reply#toggle' }
    - if comment.user == current_user
      = link_to 'Delete', [comment.commentable, comment],       |
                           method: :delete,                     |
                             data: { confirm: 'Are you sure?' } |
    \
    = render partial:  'comments/form',                                        |
      locals: { commentable: comment.commentable,                              |
                parent_id:  reply_to_comment_id(comment, nesting, max_nesting),
                    class: 'is-hidden',
                   target: 'reply.form' }

  .tile.is-parent.is-vertical{ id: "#{dom_id(comment)}_comments" }
    - if continue_thread.present? && nesting >= continue_thread
      %span= link_to 'Continue this thread', url_for(comment: comment.id, anchor: dom_id(comment))
    - else
      = render comment.comments,         nesting: nesting + 1,                 |
                                     max_nesting: local_assigns[:max_nesting], |
                                 continue_thread: continue_thread              |
